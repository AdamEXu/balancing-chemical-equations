<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speedrunning Balancing Chemical Equations</title>
</head>
<body>
    <div>
        <style>
            @keyframes rainbow {
                0% { color: red; }
                14% { color: orange; }
                28% { color: yellow; }
                42% { color: green; }
                56% { color: blue; }
                70% { color: indigo; }
                84% { color: violet; }
                100% { color: red; }
            }
            #title {
                animation: rainbow 10s infinite;
                text-shadow: 1px 1px 4px #000000;
            }
        </style>
        <h1 id="title">Speedrunning Balancing Chemical Equations</h1>
    </div>
    {% if user %}
    <div>
        <p>Welcome, {{ user.name }}!</p>
        <p><a href="/logout">Logout</a></p>
        <div>
            <style>
                @keyframes button-pulse {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.1); }
                    100% { transform: scale(1); }
                }
                button {
                    animation: button-pulse 2s infinite;
                    border: none;
                    background-color: blue;
                    color: white;
                    padding: 0;
                    text-align: center;
                    text-decoration: none;
                    display: inline-block;
                    font-family: serif;
                    margin: 20px;
                    cursor: pointer;
                }
                button:hover {
                    background-color: darkblue;
                }
            </style>
            <p style="width: 100%; text-align: center;"><button onclick="location.href=`/game?run-type=${document.getElementById('run-type').value}&music=${musicOn}`;" style="font-size: 67px;">Open simulator</button></p>
        </div>
        <p><b>Category selection: </b><select type="select" name="run-type" id="run-type">
            <option value="full">100% (full game)</option>
            <option value="easy">Easy (level 1)</option>
            <option value="medium">Medium (level 2)</option>
            <option value="hard">Hard (level 3)</option>
        </select></p>
    </div>
    {% else %}
    <div>
        <p><a href="/auth/google">Sign in with Google</a></p>
    </div>
    {% endif %}
    <p>100% = full run, completing all 3 levels, Easy = complete level 1 only, Medium = complete level 2 only, Hard = complete level 3 only</p>
    <div>
        <style>
            @keyframes bounce {
                0% { transform: translateY(0) scale(1.1) translateX(16px) scaleX(1.2) rotate(10deg); }
                50% { transform: translateY(-10px) scale(1.1) translateX(16px) scaleX(1.2) rotate(10deg); }
                100% { transform: translateY(0) scale(1.1) translateX(16px) scaleX(1.2) rotate(10deg); }
            }

            img:hover {
                animation: bounce 0.5s;
                transform: scale(1.1) translateX(16px) scaleX(1.2) rotate(10deg);
            }
        </style>
        <a onclick="toggleMusic()" style="cursor: pointer;"><img src="/static/hourglass.gif" alt="Speedrun Timer" width="100"/></a></div>
    <p>Click the above image to toggle music <b id="mus-status" style="color: red;">(music is currently off)</b></p>
    <!-- Leaderboards -->
    <h2 style="margin-top: 32px; margin-bottom: 0;">Leaderboards</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
        {% for run_type, board in leaderboards.items() %}
        <div>
            <h4>{{ board.label }}</h4>
            {% if board.entries %}
            <table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse;">
                <tr>
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Time</th>
                    <th>Date/Time (Local)</th>
                </tr>
                {% for entry in board.entries %}
                <tr>
                    <td>{{ entry.rank }}</td>
                    <td>{{ entry.name }}</td>
                    <td>{{ entry.time }}</td>
                    <td class="date-time">{{ entry.date_time }}</td>
                </tr>
                {% endfor %}
            </table>
            {% else %}
            <p><i>No runs yet</i></p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% if user %}
    <!-- your runs -->
    <h2 style="margin-bottom: 0; margin-top: 32px;">Your Runs</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
        {% for run_type in run_types %}
        <div>
            <h4>{{ run_type_labels[run_type] }}</h4>
            {% if runs[run_type] %}
            <table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse;">
                <tr>
                    <th>#</th>
                    <th>Time</th>
                    <th>Date/Time (Local)</th>
                </tr>
                {% for run in runs[run_type] %}
                <tr>
                    <td>{{ run.attempt }}</td>
                    <td>{{ run.time }}</td>
                    <td class="date-time">{{ run.date_time }}</td>
                </tr>
                {% endfor %}
            </table>
            {% else %}
            <p><i>No runs yet</i></p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <h3>FAQ</h3>
    <p>
        <ul>
            <li>
                <b>How does the game work?</b> Balance the chemical equations idk you figure it out lol
            </li>
            <li>
                <b>How does timing work?</b> Time starts upon first level selection. Time stops upon reaching the 5 star screen for the last level. Must complete all three levels (5 stars). You may reset during the run (doesn't reset timer) but your time will only count if you finish all three levels.
            </li>
            <li>
                <b>Is this even legal?</b> Yep, the code is under creative commons license and the sim is open source. I just forked it and added this stuff. <a href="https://phet.colorado.edu/en/licensing/html" target="_blank">More info here.</a>
            </li>
            <li>
                <b>What score is shown?</b> Only your best time goes on the leaderboard.
            </li>
            <li>
                <b>I got a bad time, how to remove from leaderboard?</b> Here's the great thing, you don't. Just stop skill issuing and get a better time smh
            </li>
            <li>
                <b>How to get better?</b> Idk that's a you problem lmao
            </li>
        </ul>
    </p>
    <p>
        &copy;2026 Adam Xu - Open source on GitHub <a href="https://github.com/AdamEXu/balancing-chemical-equations" target="_blank">AdamEXu/balancing-chemical-equations</a> (would appreciate a star)
    </p>
    <p>
        Fork of <a href="https://phet.colorado.edu/en/simulation/balancing-chemical-equations" target="_blank">Balancing Chemical Equations</a> by PhET Interactive Simulations, University of Colorado Boulder (Github: <a href="https://github.com/phetsims/balancing-chemical-equations" target="_blank">phetsims/balancing-chemical-equations</a>), licensed under <a href="https://phet.colorado.edu/en/licensing/html" target="_blank">Creative Commons Attribution 4.0 International (CC BY 4.0)</a>.
    </p>
    <script>
        // convert all date-time elements to user's local timezone
        document.querySelectorAll('.date-time').forEach(element => {
            const date = new Date(element.textContent + ' UTC');
            const options = { year: 'numeric', month: '2-digit', day: '2-digit',
                              hour: '2-digit', minute: '2-digit', second: '2-digit',
                              hour12: true };
            element.textContent = new Intl.DateTimeFormat('en-US', options).format(date);
        });

        // music toggle
        let musicOn = false;

        function toggleMusic() {
            musicOn = !musicOn;
            if (musicOn) {
                document.getElementById('mus-status').textContent = '(music is currently on)';
                document.getElementById('mus-status').style.color = 'green';
                playMusic();
            } else {
                document.getElementById('mus-status').textContent = '(music is currently off)';
                document.getElementById('mus-status').style.color = 'red';
                stopMusic();
            }
        }

        let currentAudio = new Audio('/static/load.mp3');
        
        function playMusic() {
            if (!currentAudio) {
                currentAudio = new Audio('/static/load.mp3');
            }
            currentAudio.loop = true;
            currentAudio.volume = 1;
            currentAudio.play();
        }

        function stopMusic() {
            if (currentAudio) {
                currentAudio.pause();
            }
        }
    </script>
</body>
</html>